<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Zikula Core</title>
        <link rel="stylesheet" href="https://docs.ziku.la/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/highlight.tomorrow-night.css">
        <link rel="stylesheet" href="https://docs.ziku.la/css/main.css">

        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
    </head>
    <body>
        <header class="navbar fixed-top navbar-dark bg-dark">
            <a class="navbar-brand" href="https://docs.ziku.la/" class="align-items-center">
                <img src="/favicon-32x32.png" alt="Zikula" />
                Zikula Core
                <small class="d-none d-lg-inline">
                    Zikula CMS and Symfony framework
                </small>
            </a>
                            <a href="https://github.com/zikula/core">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://docs.ziku.la/images/fork.png" alt="Fork me on GitHub" />
                </a>
                    </header>
        <main class="container-fluid">
            <div class="row">
                                    <nav id="sidebar" class="col-md-3 col-xl-2" role="navigation">
                                                    <p class="text-muted">
                                <a href="#section1" data-toggle="collapse">
                                    General
                                </a>
                            </p>
                            <ul id="section1" class="nav flex-column collapse show">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/index.html" class="nav-link">
                                            About
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/Contributing/index.html" class="nav-link">
                                            Contributing
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/Releases/index.html" class="nav-link">
                                            Roadmap and Releases
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/General/vendorinformation.html" class="nav-link">
                                            Vendor information
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section2" data-toggle="collapse">
                                    Setup
                                </a>
                            </p>
                            <ul id="section2" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/requirements.html" class="nav-link">
                                            Requirements
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/installation.html" class="nav-link">
                                            Installation
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Setup/upgrade.html" class="nav-link">
                                            Upgrade
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section3" data-toggle="collapse">
                                    Configuration
                                </a>
                            </p>
                            <ul id="section3" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Settings/index.html" class="nav-link">
                                            Main settings
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Localisation/index.html" class="nav-link">
                                            Localisation
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Mailer/index.html" class="nav-link">
                                            Mailer
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/AdminPanel/index.html" class="nav-link">
                                            Admin panel
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Security/index.html" class="nav-link">
                                            Security center
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Extensions/index.html" class="nav-link">
                                            Extensions
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Routes/index.html" class="nav-link">
                                            Routes
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Configuration/Workflows/index.html" class="nav-link">
                                            Workflows
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section4" data-toggle="collapse">
                                    Access Control
                                </a>
                            </p>
                            <ul id="section4" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/Groups/index.html" class="nav-link">
                                            Groups
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/Users/index.html" class="nav-link">
                                            Users
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/Authentication/index.html" class="nav-link">
                                            Authentication
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/AccessControl/Permissions/index.html" class="nav-link active">
                                            Permissions
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section5" data-toggle="collapse">
                                    Layout &amp; Design
                                </a>
                            </p>
                            <ul id="section5" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Templating/index.html" class="nav-link">
                                            Templating
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Themes/index.html" class="nav-link">
                                            Themes
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Blocks/index.html" class="nav-link">
                                            Blocks
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Menus/index.html" class="nav-link">
                                            Menus
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/LayoutDesign/Forms/index.html" class="nav-link">
                                            Forms
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section6" data-toggle="collapse">
                                    Translation
                                </a>
                            </p>
                            <ul id="section6" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Translation/index.html" class="nav-link">
                                            Overview
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section7" data-toggle="collapse">
                                    Integration
                                </a>
                            </p>
                            <ul id="section7" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Integration/Categories/index.html" class="nav-link">
                                            Categories
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Integration/Search/index.html" class="nav-link">
                                            Search
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section8" data-toggle="collapse">
                                    Extensions
                                </a>
                            </p>
                            <ul id="section8" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Extensions/content.html" class="nav-link">
                                            Content
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Extensions/other.html" class="nav-link">
                                            Other
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section9" data-toggle="collapse">
                                    Extension Development
                                </a>
                            </p>
                            <ul id="section9" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/General/index.html" class="nav-link">
                                            General
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Doctrine/index.html" class="nav-link">
                                            Databases & Doctrine
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Extensions/index.html" class="nav-link">
                                            Extension services
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Hooks/index.html" class="nav-link">
                                            Hooks
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://docs.ziku.la/Development/Misc/index.html" class="nav-link">
                                            Misc
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://modulestudio.de/en/documentation/10-introduction/" class="nav-link">
                                            Model-driven approach
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                <a href="#section10" data-toggle="collapse">
                                    Resources
                                </a>
                            </p>
                            <ul id="section10" class="nav flex-column collapse">
                                                                    <li class="nav-item">
                                        <a href="https://ziku.la" class="nav-link">
                                            Zikula website
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://github.com/zikula/core" class="nav-link">
                                            <i class="fab fa-github"></i> GitHub
                                        </a>
                                    </li>
                                                                    <li class="nav-item">
                                        <a href="https://joinslack.ziku.la/" class="nav-link">
                                            <i class="fab fa-slack"></i> Slack
                                        </a>
                                    </li>
                                                            </ul>
                                            </nav>
                                <section class="offset-md-3 offset-xl-2 col-md-9 col-xl-10">
                    <h1 id="how-to-implement-permissions">How to implement permissions</h1>
<h2 id="declare-permission-schema">Declare permission schema</h2>
<p>An extension needs to declare all permission components and instance templates in <code>composer.json</code>. This is required to let the permissions system know them which helps supporting site administrators <a href="../management.html">looking up components and instances</a>.</p>
<p>The following example shows how this is done:</p>
<pre><code class="language-yaml">{
    "name": "acme/person-module",
    ...
    "extra": {
        "zikula": {
            ...
            "securityschema": {
                "AcmePersonModule::": "::",
                "AcmePersonModule:SomeBlock:": "Block title::",
                "AcmePersonModule:Person:": "Person ID::",
                "AcmePersonModule:Address:": "Address ID::",
                ...
            }
        }
    }
}</code></pre>
<p>Each entry in the <code>securityschema</code> array consists of a component (key) and a template for the instances (value).</p>
<p>The extension author is completely free in deciding which components and instances are supported.</p>
<h2 id="basic-usage">Basic usage</h2>
<p>Typically required permissions are checked for using the <a href="permissionapi.html">PermissionApi</a>.</p>
<h3 id="in-controllers">In controllers</h3>
<p>The <code>Zikula\Bundle\CoreBundle\Controller\AbstractController\AbstractController</code> class provides a shortcut method:</p>
<ul>
<li><code>hasPermission(string $component = null, string $instance = null, int $level = null, int $user = null): bool</code></li>
</ul>
<p>The following code shows a possible example how to use this in a controller method:</p>
<pre><code class="language-php">namespace Acme\PersonModule\Controller;

use Acme\PersonModule\Entity\PersonEntity;
use Symfony\Component\HttpFoundation\RedirectResponse;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\Security\Core\Exception\AccessDeniedException;
use Zikula\Bundle\CoreBundle\Controller\AbstractController;

class PersonController extends AbstractController
{
    /**
     * @Route("/admin/edit/{personid}", requirements={"personid" = "^[1-9]\d*$"})
     * @Theme("admin")
     * @Template("@AcmePersonModule/Person/edit.html.twig")
     *
     * Modify a person.
     *
     * @return array|RedirectResponse
     * @throws AccessDeniedException Thrown if the user hasn't permissions to edit the person
     */
    public function editAction(
        Request $request,
        PersonEntity $person
    ) {
        if (!$this-&gt;hasPermission('AcmePersonModule::', $person-&gt;getId() . '::', ACCESS_EDIT)) {
            throw new AccessDeniedException();
        }

        // ...
    }
}</code></pre>
<h3 id="direct-usage">Direct usage</h3>
<p>Of course the <a href="permissionapi.html">PermissionApi</a> can also be injected as a service into any class if desired.</p>
<pre><code class="language-php">namespace Acme\PersonModule\Helper;

use Acme\PersonModule\Entity\PersonEntity;
use Symfony\Component\Security\Core\Exception\AccessDeniedException;
use Zikula\PermissionsModule\Api\ApiInterface\PermissionApiInterface;

class MyService
{
    /**
     * @var PermissionApiInterface
     */
    private $permissionApi;

    public function __construct(PermissionApiInterface $permissionApi)
    {
        $this-&gt;permissionApi = $permissionApi;
    }

    public function processPerson(PersonEntity $person)
    {
        if (!$this-&gt;permissionApi-&gt;hasPermission('AcmePersonModule::', $person-&gt;getId() . '::', ACCESS_EDIT)) {
            throw new AccessDeniedException();
        }
    }
}</code></pre>
<h2 id="using-an-annotation">Using an annotation</h2>
<p>Controllers may also use a <a href="permissioncheckannotation.html">PermissionCheck Annotation</a> to perform permission checks in a declarative way.</p>
<p>The controller example from above would look like this then:</p>
<pre><code class="language-php">namespace Acme\PersonModule\Controller;

use Acme\PersonModule\Entity\PersonEntity;
use Symfony\Component\HttpFoundation\Request;
use Zikula\Bundle\CoreBundle\Controller\AbstractController;
use Zikula\PermissionsModule\Annotation\PermissionCheck;

class PersonController extends AbstractController
{
    /**
     * @Route("/admin/edit/{personid}", requirements={"personid" = "^[1-9]\d*$"})
     * @PermissionCheck({"$_zkModule::", "$personid::", "edit"})
     * @Theme("admin")
     * @Template("@AcmePersonModule/Person/edit.html.twig")
     */
    public function editAction(
        Request $request,
        PersonEntity $person
    ) {
        // ...
    }
}</code></pre>
<p>Note this is limited to one permission check for each method. It is not possible to have multiple occurrences in a method's doc block. If more complex evaluations are required, permission API should be used instead (see above).</p>
<p>It is also possible to use the annotation on class-level. But it is not allowed to use it for a class <em>and</em> for it's methods concurrently.</p>
<p>Example for a class-level use case:</p>
<pre><code class="language-php">namespace Acme\PersonModule\Controller;

use Acme\PersonModule\Entity\PersonEntity;
use Symfony\Component\HttpFoundation\Request;
use Zikula\Bundle\CoreBundle\Controller\AbstractController;
use Zikula\PermissionsModule\Annotation\PermissionCheck;

/**
 * @PermissionCheck("admin")
 */
class ConfigController extends AbstractController
{
    public function someAction(Request $request)
    {
        // ...
    }

    public function otherAction(Request $request)
    {
        // ...
    }
}</code></pre>
<p>For more details see the <a href="permissioncheckannotation.html">PermissionCheck Annotation document</a>.</p>
<h2 id="twig-templates">Twig templates</h2>
<p>You can use <code>hasPermission</code> inside templates similarly as in PHP. The only difference is that the permission level constants need to be declared as strings.</p>
<p>Example:</p>
<pre><code class="language-twig">{% if hasPermission('AcmePersonModule::', person.id ~ '::', 'ACCESS_READ') %}
    &lt;h3&gt;{{ person.name }}&lt;/h3&gt;
{% endif %}</code></pre>
<h2 id="special-aspects">Special aspects</h2>
<h3 id="check-permissions-for-specific-users">Check permissions for specific users</h3>
<p>By default permission checks are always executed for the current user. Internally the <a href="permissionapi.html">PermissionApi</a> uses the <a href="../../Users/Dev/currentuserapi.html">CurrentUserApi</a> for that.</p>
<p>In order to explicitly perform a permission check for a specific user, it is possible to assign the corresponding user ID as the fourth parameter for the <code>hasPermission()</code> method of both <code>AbstractController</code> and <code>PermissionApi</code>.</p>
<p>Note the annotation-based checks are always done for the current user.</p>
<h3 id="permissions-for">Permissions for <em>own</em> data</h3>
<p>The permissions system does not have a default way to express ownerships. The reason for this is that extensions may implement arbitrary logic and rules for when some data is considered as owned by a user.</p>
<p>Common approaches for handling such requirements are for example:</p>
<ul>
<li>Use a separate permission component, like <code>AcmeRecipesModule:Own:(Ingredients|Recipes)</code>.</li>
<li>Do a comparison of the current user's ID with the owner ID.</li>
<li>Use dedicated configuration options, for example user group selectors, to store a group ID which may do additional things (independent of permissions).</li>
<li>Combine these steps.</li>
</ul>
<h3 id="category-based-permissions">Category-based permissions</h3>
<p>If an extension utilises the side-wide category system. it could become helpful to be able to filter data based on permissions for categories.</p>
<p>For further information about this please refer to the <a href="../../Integration/Categories/index.html">Categories docs</a>, particularly <a href="../../Integration/Categories/Dev/categorypermissionapi.html">CategoryPermissionApi</a>.</p>
                </section>
            </div>
        </main>
        <script src="https://docs.ziku.la/js/jquery.min.js"></script>
        <script src="https://docs.ziku.la/js/bootstrap.bundle.min.js"></script>
        <script src="https://docs.ziku.la/js/highlight.pack.js"></script>
        <script src="https://docs.ziku.la/js/site.js"></script>
    </body>
</html>
